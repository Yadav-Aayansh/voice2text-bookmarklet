<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gemini Voice-to-Text Bookmarklet (Single File)</title>
  <style>
    :root {
      --bg: #f9fafb;
      --text: #111827;
      --muted: #6b7280;
      --primary: #4f46e5;
      --primary-hover: #4338ca;
      --white: #ffffff;
      --shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
      --radius: 16px;
    }

    html,
    body {
      height: 100%;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, Ubuntu, Cantarell, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .card {
      width: 100%;
      max-width: 720px;
      background: var(--white);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 32px;
      text-align: center;
    }

    h1 {
      margin: 0 0 12px;
      font-size: 24px;
      font-weight: 800;
    }

    p {
      margin: 0 0 16px;
      color: var(--muted);
    }

    .btn {
      appearance: none;
      border: 0;
      border-radius: 12px;
      background: var(--primary);
      color: #fff;
      font-weight: 700;
      padding: 12px 20px;
      cursor: pointer;
      box-shadow: 0 8px 18px rgba(79, 70, 229, 0.25);
      transition: background .2s ease, transform .05s ease;
    }

    .btn:hover {
      background: var(--primary-hover);
    }

    .btn:active {
      transform: translateY(1px);
    }

    a.bookmarklet {
      color: var(--primary);
      text-decoration: underline;
      word-break: break-all;
    }

    .hint {
      font-size: 12px;
      color: var(--muted);
      margin-top: 18px;
    }
  </style>
</head>

<body>
  <div class="card">
    <h1>üé§ Gemini Audio Transcriber</h1>
    <p>Click to start/stop recording and transcribe your speech.<br />Or drag the link below to your bookmarks bar.</p>
    <button id="startBtn" class="btn">üé§ Start/Stop Recording</button>
    <p class="hint">Drag this to your bookmarks bar: <a class="bookmarklet"
        href="javascript:(async()=>{if(!window._geminiRecorder){window._geminiRecorder={recording:false,chunks:[],mediaRecorder:null,paused:false,apiKey:null,baseUrl:null};}const s=window._geminiRecorder;const showConfigDialog=()=>{const overlay=document.createElement('div');overlay.id='gemini-config-overlay';overlay.style='position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1000000;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(5px);';const dialog=document.createElement('div');dialog.style='background:white;padding:30px;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,0.3);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;width:400px;max-width:90vw;';dialog.innerHTML='<div style='+`'text-align:center;margin-bottom:25px;'`+'><h2 style='+`'margin:0;color:#333;font-size:24px;font-weight:600;'`+'>üé§ Gemini Setup</h2><p style='+`'margin:10px 0 0;color:#666;font-size:14px;'`+'>Enter your API credentials to get started</p></div><div style='+`'margin-bottom:20px;'`+'><label style='+`'display:block;margin-bottom:8px;color:#333;font-weight:500;font-size:14px;'`+'>Gemini API Key</label><input id='+`'api-key-input'`+' type='+`'password'`+' placeholder='+`'Enter your Gemini API key'`+' style='+`'width:100%;padding:12px 16px;border:2px solid #e1e5e9;border-radius:12px;font-size:14px;box-sizing:border-box;transition:border-color 0.2s;font-family:inherit;'`+' /></div><div style='+`'margin-bottom:25px;'`+'><label style='+`'display:block;margin-bottom:8px;color:#333;font-weight:500;font-size:14px;'`+'>Base URL</label><input id='+`'base-url-input'`+' type='+`'text'`+' placeholder='+`'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent'`+' style='+`'width:100%;padding:12px 16px;border:2px solid #e1e5e9;border-radius:12px;font-size:14px;box-sizing:border-box;transition:border-color 0.2s;font-family:inherit;'`+' /></div><div style='+`'display:flex;gap:12px;justify-content:flex-end;'`+'><button id='+`'config-cancel'`+' style='+`'padding:12px 24px;border:2px solid #e1e5e9;background:white;color:#666;border-radius:12px;cursor:pointer;font-weight:500;font-size:14px;transition:all 0.2s;'`+'>Cancel</button><button id='+`'config-save'`+' style='+`'padding:12px 24px;border:none;background:linear-gradient(135deg,#667eea,#764ba2);color:white;border-radius:12px;cursor:pointer;font-weight:500;font-size:14px;transition:all 0.2s;'`+'>Save & Continue</button></div>';overlay.appendChild(dialog);document.body.appendChild(overlay);const apiInput=document.getElementById('api-key-input');const urlInput=document.getElementById('base-url-input');const saveBtn=document.getElementById('config-save');const cancelBtn=document.getElementById('config-cancel');apiInput.style.outline='none';urlInput.style.outline='none';apiInput.onfocus=()=>apiInput.style.borderColor='#667eea';apiInput.onblur=()=>apiInput.style.borderColor='#e1e5e9';urlInput.onfocus=()=>urlInput.style.borderColor='#667eea';urlInput.onblur=()=>urlInput.style.borderColor='#e1e5e9';saveBtn.onmouseover=()=>saveBtn.style.transform='translateY(-1px)';saveBtn.onmouseout=()=>saveBtn.style.transform='translateY(0)';cancelBtn.onmouseover=()=>cancelBtn.style.borderColor='#ccc';cancelBtn.onmouseout=()=>cancelBtn.style.borderColor='#e1e5e9';if(s.apiKey)apiInput.value=s.apiKey;if(s.baseUrl)urlInput.value=s.baseUrl;else urlInput.value='https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent';const closeDialog=()=>overlay.remove();saveBtn.onclick=()=>{const key=apiInput.value.trim();const url=urlInput.value.trim();if(!key){apiInput.style.borderColor='#f44336';apiInput.focus();return;}if(!url){urlInput.style.borderColor='#f44336';urlInput.focus();return;}s.apiKey=key;s.baseUrl=url;closeDialog();createRecorderUI();};cancelBtn.onclick=closeDialog;overlay.onclick=(e)=>{if(e.target===overlay)closeDialog();};};const createRecorderUI=()=>{let popup=document.getElementById('gemini-popup');if(popup)popup.remove();popup=document.createElement('div');popup.id='gemini-popup';popup.style='position:fixed;bottom:20px;right:20px;background:linear-gradient(135deg,#667eea,#764ba2);border:none;padding:20px;border-radius:20px;box-shadow:0 10px 30px rgba(0,0,0,0.3);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;z-index:999999;color:white;width:280px;backdrop-filter:blur(10px);';popup.innerHTML='<div style='+`'display:flex;align-items:center;justify-content:space-between;margin-bottom:15px;'`+'><div style='+`'display:flex;align-items:center;font-weight:600;font-size:16px;'`+'><span style='+`'margin-right:8px;'`+'>üé§</span>Voice Recorder</div><div><button id='+`'config-btn'`+' style='+`'background:rgba(255,255,255,0.2);border:none;color:white;width:24px;height:24px;border-radius:50%;cursor:pointer;font-size:12px;margin-right:8px;'`+' title='+`'Settings'`+'>‚öô</button><button id='+`'close-btn'`+' style='+`'background:rgba(255,255,255,0.2);border:none;color:white;width:24px;height:24px;border-radius:50%;cursor:pointer;font-size:14px;'`+'>√ó</button></div></div><div id='+`'status'`+' style='+`'font-size:12px;opacity:0.9;margin-bottom:15px;padding:8px;background:rgba(255,255,255,0.1);border-radius:8px;'`+'>Ready to record</div><div style='+`'display:flex;gap:8px;flex-wrap:wrap;'`+'><button id='+`'start-btn'`+' style='+`'background:#4CAF50;border:none;color:white;padding:10px 16px;border-radius:12px;cursor:pointer;font-weight:500;font-size:13px;flex:1;min-width:70px;transition:all 0.2s;'`+'>‚ñ∂ Start</button><button id='+`'pause-btn'`+' style='+`'background:#FF9800;border:none;color:white;padding:10px 16px;border-radius:12px;cursor:pointer;font-weight:500;font-size:13px;flex:1;min-width:70px;transition:all 0.2s;opacity:0.5;'`+' disabled>‚è∏ Pause</button><button id='+`'resume-btn'`+' style='+`'background:#2196F3;border:none;color:white;padding:10px 16px;border-radius:12px;cursor:pointer;font-weight:500;font-size:13px;flex:1;min-width:70px;transition:all 0.2s;display:none;'`+'>‚ñ∂ Resume</button><button id='+`'stop-btn'`+' style='+`'background:#f44336;border:none;color:white;padding:10px 16px;border-radius:12px;cursor:pointer;font-weight:500;font-size:13px;flex:1;min-width:70px;transition:all 0.2s;opacity:0.5;'`+' disabled>‚èπ Stop</button></div>';document.body.appendChild(popup);const startBtn=document.getElementById('start-btn');const pauseBtn=document.getElementById('pause-btn');const resumeBtn=document.getElementById('resume-btn');const stopBtn=document.getElementById('stop-btn');const status=document.getElementById('status');const closeBtn=document.getElementById('close-btn');const configBtn=document.getElementById('config-btn');const updateUI=(state)=>{startBtn.style.opacity=state==='idle'?'1':'0.5';startBtn.disabled=state!=='idle';pauseBtn.style.opacity=state==='recording'?'1':'0.5';pauseBtn.disabled=state!=='recording';resumeBtn.style.display=state==='paused'?'block':'none';stopBtn.style.opacity=state==='recording'||state==='paused'?'1':'0.5';stopBtn.disabled=state!=='recording'&&state!=='paused';status.textContent=state==='idle'?'Ready to record':state==='recording'?'üî¥ Recording...':state==='paused'?'‚è∏ Paused':'Processing...';};startBtn.onclick=async()=>{try{const m=await navigator.mediaDevices.getUserMedia({audio:true});const r=new MediaRecorder(m);s.chunks=[];r.ondataavailable=e=>s.chunks.push(e.data);r.onstop=async()=>{updateUI('processing');try{const b=new Blob(s.chunks,{type:'audio/webm'});s.mediaRecorder=null;m.getTracks().forEach(t=>t.stop());if(b.size<1024){status.innerHTML='<span style='+`'color:#ffcdd2;'`+'>Recording too short</span>';setTimeout(()=>updateUI('idle'),2000);return;}const reader=new FileReader();reader.onload=async()=>{try{const d=reader.result.split(',')[1];const x=await fetch(s.baseUrl+'?key='+s.apiKey,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({contents:[{parts:[{text:'Transcribe this audio to text accurately. Return ONLY the plain transcription text, no extra words:'},{inline_data:{mime_type:'audio/webm',data:d}}]}],generationConfig:{temperature:0.2,maxOutputTokens:8192}})});const j=await x.json();const t=j?.candidates?.[0]?.content?.parts?.[0]?.text?.trim()||'(no text)';const f=document.activeElement;if(f&&(f.tagName==='INPUT'||f.tagName==='TEXTAREA'||f.isContentEditable)){if('value'in f)f.value+=(f.value?' ':'')+t;else f.innerText+=(f.innerText?' ':'')+t;f.dispatchEvent(new Event('input',{bubbles:true}));status.innerHTML='<span style='+`'color:#c8e6c9;'`+'>‚úì Text inserted</span>';}else{navigator.clipboard?.writeText(t);status.innerHTML='<span style='+`'color:#c8e6c9;'`+'>‚úì Copied to clipboard</span>';}setTimeout(()=>updateUI('idle'),2000);}catch(e){status.innerHTML='<span style='+`'color:#ffcdd2;'`+'>API error: '+e.message+'</span>';setTimeout(()=>updateUI('idle'),3000);}};reader.readAsDataURL(b);}catch(e){status.innerHTML='<span style='+`'color:#ffcdd2;'`+'>Processing error</span>';setTimeout(()=>updateUI('idle'),3000);}};r.start();s.mediaRecorder=r;s.paused=false;updateUI('recording');}catch(e){status.innerHTML='<span style='+`'color:#ffcdd2;'`+'>Mic access denied</span>';setTimeout(()=>updateUI('idle'),3000);}};pauseBtn.onclick=()=>{if(s.mediaRecorder&&!s.paused){s.mediaRecorder.pause();s.paused=true;updateUI('paused');}};resumeBtn.onclick=()=>{if(s.mediaRecorder&&s.paused){s.mediaRecorder.resume();s.paused=false;updateUI('recording');}};stopBtn.onclick=()=>{if(s.mediaRecorder){s.mediaRecorder.stop();s.recording=false;s.paused=false;}};closeBtn.onclick=()=>{if(s.mediaRecorder){s.mediaRecorder.stop();s.mediaRecorder.stream?.getTracks().forEach(t=>t.stop());}popup.remove();};configBtn.onclick=showConfigDialog;updateUI('idle');};if(!s.apiKey||!s.baseUrl){showConfigDialog();}else{createRecorderUI();}})();">
        Voice2Text</a></p>
    <p class="hint">Your API key is securely stored in your browser's localStorage under "gemini_api_key".</p>
  </div>
  <script>const recorderFunction = async () => { if (!window._geminiRecorder) { window._geminiRecorder = { recording: false, chunks: [], mediaRecorder: null }; } const s = window._geminiRecorder; let k = localStorage.getItem("gemini_api_key"); if (!k) { k = prompt("Enter Gemini API Key:"); if (!k) return; localStorage.setItem("gemini_api_key", k); } if (!s.recording) { try { if (s.mediaRecorder) { try { s.mediaRecorder.onstop = null; s.mediaRecorder.stream.getTracks().forEach(t => t.stop()); } catch (e) { } } const m = await navigator.mediaDevices.getUserMedia({ audio: true }); const r = new MediaRecorder(m); s.chunks = []; r.ondataavailable = e => s.chunks.push(e.data); r.onstop = async () => { try { const b = new Blob(s.chunks, { type: "audio/webm" }); s.mediaRecorder = null; m.getTracks().forEach(t => t.stop()); if (b.size < 1024) { alert("Recording too short (<1s). Try again."); return; } const reader = new FileReader(); reader.readAsDataURL(b); await new Promise(resolve => reader.onload = resolve); const d = reader.result.split(',')[1]; const x = await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=" + k, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ contents: [{ parts: [{ text: "Transcribe this audio to text accurately. Return ONLY the plain transcription text, no additional words, formatting, or explanations:" }, { inline_data: { mime_type: "audio/webm", data: d } }] }], generationConfig: { temperature: 0.2, maxOutputTokens: 8192 } }) }); const j = await x.json(); const t = j?.candidates?.[0]?.content?.parts?.[0]?.text?.trim() || "(no text)"; const f = document.activeElement; if (f && (f.tagName === "INPUT" || f.tagName === "TEXTAREA" || f.isContentEditable)) { if ("value" in f) f.value += (f.value ? " " : "") + t; else f.innerText += (f.innerText ? " " : "") + t; f.dispatchEvent(new Event("input", { bubbles: true })); } else alert("Result: " + t); } catch (e) { alert("Processing error: " + e.message); } }; r.start(); s.mediaRecorder = r; s.recording = true; alert("üé§ Recording started... click again to stop"); } catch (e) { alert("Mic error: " + e); } return; } s.recording = false; if (s.mediaRecorder) { s.mediaRecorder.stop(); } }; document.getElementById('startBtn').addEventListener('click', recorderFunction);</script>
</body>

</html>
